{% load static %}
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê²Œì‹œë¬¼ ë³´ê¸°</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body class="detail-body">
    <div class="article-header">
        <div class="post">
            <h2 class="title">ğŸ“ {{ article.title }}</h2>
            <p class="author">ì‘ì„±ì : {{ article.author.nickname|default:"ì•Œ ìˆ˜ ì—†ìŒ" }}</p>
        </div>
        <div class="view">
            <strong>ì¡°íšŒìˆ˜ :</strong> {{ article.views }}
        </div>
    </div>
    <hr>
    
    <div class="article">
        <div class="article-body">
            <p class="article-content">{{ article.content }}</p>
            <form method="post" action="{% url 'like' article.pk %}" style="display: inline;">
                {% csrf_token %}
                {% if user.is_authenticated %}
                    <button type="submit" class="like-button">
                        {% if is_liked %}
                            â¤ï¸
                        {% else %}
                            ğŸ¤
                        {% endif %}
                        {{ article.like_set.count }}
                    </button>
                {% endif %}
            </form>
        </div>

        {% if article.photo %}
            <img src="{{ article.photo.url }}" alt="ì‚¬ì§„" class="article-photo">
        {% endif %}
        <p>ê¸°ìˆ  ìŠ¤íƒ: {{ article.tech_stack }}</p>
        <p>ê¹ƒí—ˆë¸Œ ë§í¬: <a href="{{ article.github_link }}">{{ article.github_link }}</a></p>
    </div>

    <div class="comment">
        <h3 class=comment-header>ëŒ“ê¸€</h3>
        <form method="POST">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit">ëŒ“ê¸€ ì‘ì„±</button>
        </form>

        {% load dict_extras %}
        <ul>
            {% for comment in comments %}
                <div class="comment-area">
                    <strong>{{ comment.author.nickname }}</strong>
                    <small>{{ comment.created_at|date:"Y.m.d H:i" }}</small><br>
                    {{ comment.content }}

                    <!-- ëŒ“ê¸€ ì¢‹ì•„ìš” ë²„íŠ¼ -->
                    <form action="{% url 'comment_like' comment.id %}" method="POST" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" class="like-button comment">
                            {% if comment.id in user_liked_comments %}
                                â¤ï¸
                            {% else %}
                                ğŸ¤
                            {% endif %}
                            {{ comment_likes|get_item:comment.id }}
                        </button>
                    </form>

                    <!-- ëŒ€ëŒ“ê¸€ í¼ -->
                    <form method="POST" style="margin-left: 20px;">
                        {% csrf_token %}
                        <textarea name="content" rows="2" placeholder="ë‹µê¸€ ì‘ì„±..."></textarea>
                        <input type="hidden" name="parent_id" value="{{ comment.id }}">
                        <button type="submit">ë‹µê¸€</button>
                    </form>

                    <!-- ëŒ€ëŒ“ê¸€ í‘œì‹œ -->
                    <ul>
                        {% for reply in comment.replies.all %}
                            <li style="margin-left: 20px;">
                                <strong>{{ reply.author.nickname }}</strong>
                                <small>{{ reply.created_at|date:"Y.m.d H:i" }}</small><br>
                                {{ reply.content }}

                                <!-- ëŒ€ëŒ“ê¸€ ì¢‹ì•„ìš” ë²„íŠ¼ -->
                                <form action="{% url 'comment_like' reply.id %}" method="POST" style="display: inline;">
                                    {% csrf_token %}
                                    <button type="submit" class="like-button comment">
                                        {% if reply.id in user_liked_comments %}
                                            â¤ï¸
                                        {% else %}
                                            ğŸ¤
                                        {% endif %}
                                        {{ comment_likes|get_item:reply.id }}
                                    </button>
                                </form>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            {% endfor %}
        </ul>
    </div>

    <div class="button-group">
        <button type="button" onclick="location.href='{% url 'article_create' %}'">ê²Œì‹œë¬¼ ì‘ì„±í•˜ê¸°</button>
        <button type="button" onclick="location.href='{% url 'article_list' %}'">ê²Œì‹œë¬¼ ëª©ë¡ ë³´ê¸°</button>
        <button type="button" onclick="location.href='{% url 'main' %}'">ë©”ì¸ìœ¼ë¡œ</button>
    </div>
    
</body>
</html>